{
  "info": {
    "_postman_id": "eyada-secretary-collection",
    "name": "Eyada - Secretary Portal",
    "description": "Professional Postman Collection for Secretary role in Eyada Clinic Management System.\n\n## Features\n- Automatic token management\n- Auto-refresh expired tokens\n- Environment variables\n- Pre-request scripts\n- Response tests\n\n## Setup\n1. Import the Environment file\n2. Set your `baseUrl` (default: http://localhost:3000)\n3. Start with Login request\n\n## Token Management\n- Tokens are automatically saved after login\n- Access token expires in 15 minutes\n- Refresh token expires in 7 days\n- Auto-refresh happens automatically",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{accessToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global Pre-request Script - Auto Token Refresh",
          "",
          "const noAuthRequired = ['/auth/login', '/auth/register', '/auth/refresh'];",
          "const currentPath = pm.request.url.getPath();",
          "",
          "// Skip token check for auth endpoints",
          "if (noAuthRequired.some(path => currentPath.includes(path))) {",
          "    return;",
          "}",
          "",
          "// Check if we have tokens",
          "const accessToken = pm.environment.get('accessToken');",
          "const refreshToken = pm.environment.get('refreshToken');",
          "const tokenExpiry = pm.environment.get('tokenExpiry');",
          "",
          "if (!accessToken) {",
          "    console.log('No access token found. Please login first.');",
          "    return;",
          "}",
          "",
          "// Check if token is expired or about to expire (1 minute buffer)",
          "const now = Date.now();",
          "const expiryTime = parseInt(tokenExpiry) || 0;",
          "const bufferTime = 60 * 1000; // 1 minute",
          "",
          "if (expiryTime && (now >= expiryTime - bufferTime)) {",
          "    console.log('Token expired or expiring soon. Refreshing...');",
          "    ",
          "    const baseUrl = pm.environment.get('baseUrl') || pm.collectionVariables.get('baseUrl');",
          "    ",
          "    pm.sendRequest({",
          "        url: baseUrl + '/auth/refresh',",
          "        method: 'POST',",
          "        header: {",
          "            'Content-Type': 'application/json'",
          "        },",
          "        body: {",
          "            mode: 'raw',",
          "            raw: JSON.stringify({ refreshToken: refreshToken })",
          "        }",
          "    }, function (err, response) {",
          "        if (err) {",
          "            console.error('Token refresh failed:', err);",
          "            return;",
          "        }",
          "        ",
          "        if (response.code === 200) {",
          "            const jsonData = response.json();",
          "            pm.environment.set('accessToken', jsonData.accessToken);",
          "            pm.environment.set('refreshToken', jsonData.refreshToken);",
          "            // Set new expiry (15 minutes from now)",
          "            pm.environment.set('tokenExpiry', Date.now() + (15 * 60 * 1000));",
          "            console.log('Token refreshed successfully!');",
          "        } else {",
          "            console.error('Token refresh failed with status:', response.code);",
          "            pm.environment.unset('accessToken');",
          "            pm.environment.unset('refreshToken');",
          "            pm.environment.unset('tokenExpiry');",
          "        }",
          "    });",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global Test Script",
          "",
          "// Log response time",
          "console.log('Response Time: ' + pm.response.responseTime + 'ms');",
          "",
          "// Check for common error patterns",
          "if (pm.response.code === 401) {",
          "    console.warn('Unauthorized - Token may be expired or invalid');",
          "}",
          "",
          "if (pm.response.code === 403) {",
          "    console.warn('Forbidden - You may not have the required role (SECRETARY)');",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "Authentication",
      "description": "Authentication endpoints for Secretary",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// Test: Login Response",
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has tokens', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('accessToken');",
                  "    pm.expect(jsonData).to.have.property('refreshToken');",
                  "    pm.expect(jsonData).to.have.property('user');",
                  "});",
                  "",
                  "pm.test('User has SECRETARY role', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.user.role).to.equal('SECRETARY');",
                  "});",
                  "",
                  "// Save tokens to environment",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    ",
                  "    pm.environment.set('accessToken', jsonData.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "    pm.environment.set('userId', jsonData.user.id);",
                  "    pm.environment.set('userEmail', jsonData.user.email);",
                  "    pm.environment.set('userName', jsonData.user.fullName);",
                  "    pm.environment.set('userRole', jsonData.user.role);",
                  "    ",
                  "    // Set token expiry (15 minutes from now)",
                  "    pm.environment.set('tokenExpiry', Date.now() + (15 * 60 * 1000));",
                  "    ",
                  "    console.log('Login successful! Tokens saved.');",
                  "    console.log('User:', jsonData.user.fullName);",
                  "    console.log('Role:', jsonData.user.role);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"email\": \"{{secretaryEmail}}\",\n    \"password\": \"{{secretaryPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "Login as Secretary with email and password.\n\nThe secretary account is created by the Doctor or Admin who assigns them to a clinic.\n\n**Required:**\n- `email`: Secretary's email\n- `password`: Secretary's password"
          },
          "response": [
            {
              "name": "Successful Login",
              "originalRequest": {
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"email\": \"secretary@clinic.com\",\n    \"password\": \"Secretary@123\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/auth/login",
                  "host": ["{{baseUrl}}"],
                  "path": ["auth", "login"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "body": "{\n    \"accessToken\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n    \"refreshToken\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"user\": {\n        \"id\": \"123e4567-e89b-12d3-a456-426614174000\",\n        \"email\": \"secretary@clinic.com\",\n        \"fullName\": \"Sarah Ahmed\",\n        \"role\": \"SECRETARY\"\n    }\n}"
            }
          ]
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has new tokens', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('accessToken');",
                  "    pm.expect(jsonData).to.have.property('refreshToken');",
                  "});",
                  "",
                  "// Update tokens",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('accessToken', jsonData.accessToken);",
                  "    pm.environment.set('refreshToken', jsonData.refreshToken);",
                  "    pm.environment.set('tokenExpiry', Date.now() + (15 * 60 * 1000));",
                  "    console.log('Tokens refreshed successfully!');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Refresh the access token using the refresh token.\n\nThis is called automatically by the pre-request script when the token is about to expire."
          },
          "response": []
        },
        {
          "name": "Get My Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Profile data is returned', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('email');",
                  "    pm.expect(jsonData).to.have.property('fullName');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            },
            "description": "Get the current logged-in user's profile information."
          },
          "response": []
        },
        {
          "name": "Change Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Success message returned', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.message).to.include('successfully');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"currentPassword\": \"OldPassword@123\",\n    \"newPassword\": \"NewPassword@123\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            },
            "description": "Change the current user's password.\n\n**Password Requirements:**\n- Minimum 8 characters\n- At least 1 uppercase letter\n- At least 1 lowercase letter\n- At least 1 number or special character"
          },
          "response": []
        },
        {
          "name": "Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Clear tokens on logout",
                  "if (pm.response.code === 200) {",
                  "    // Keep the tokens for now, user might want to refresh",
                  "    console.log('Logged out successfully');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            },
            "description": "Logout from the current session. This invalidates the refresh token."
          },
          "response": []
        },
        {
          "name": "Logout All Devices",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Clear all tokens",
                  "if (pm.response.code === 200) {",
                  "    pm.environment.unset('accessToken');",
                  "    pm.environment.unset('refreshToken');",
                  "    pm.environment.unset('tokenExpiry');",
                  "    console.log('Logged out from all devices');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/logout-all",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout-all"]
            },
            "description": "Logout from all devices. This invalidates all refresh tokens for this user."
          },
          "response": []
        }
      ]
    },
    {
      "name": "My Clinics",
      "description": "View clinics assigned to the secretary",
      "item": [
        {
          "name": "Get My Assigned Clinics",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "// Save first clinic ID for later use",
                  "if (pm.response.code === 200) {",
                  "    const clinics = pm.response.json();",
                  "    if (clinics.length > 0) {",
                  "        pm.environment.set('clinicId', clinics[0].id);",
                  "        pm.environment.set('clinicName', clinics[0].name?.ar || clinics[0].name?.en);",
                  "        console.log('Found ' + clinics.length + ' clinic(s)');",
                  "        console.log('Primary clinic:', clinics[0].name?.ar || clinics[0].name?.en);",
                  "        ",
                  "        // Save service types if available",
                  "        if (clinics[0].serviceTypes && clinics[0].serviceTypes.length > 0) {",
                  "            pm.environment.set('serviceTypeId', clinics[0].serviceTypes[0].id);",
                  "        }",
                  "    } else {",
                  "        console.warn('No clinics assigned to this secretary');",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/clinics",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "clinics"]
            },
            "description": "Get all clinics assigned to the current secretary.\n\nReturns clinic details including:\n- Doctor information\n- Specialty\n- Location\n- Active service types"
          },
          "response": [
            {
              "name": "Clinics List",
              "originalRequest": {
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{baseUrl}}/secretary/appointments/clinics",
                  "host": ["{{baseUrl}}"],
                  "path": ["secretary", "appointments", "clinics"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "body": "[\n    {\n        \"id\": \"clinic-uuid\",\n        \"name\": {\n            \"ar\": \"\u0639\u064a\u0627\u062f\u0629 \u0627\u0644\u0646\u0648\u0631\",\n            \"en\": \"Al-Noor Clinic\"\n        },\n        \"doctorProfile\": {\n            \"user\": {\n                \"id\": \"doctor-uuid\",\n                \"fullName\": \"\u062f. \u0623\u062d\u0645\u062f \u0645\u062d\u0645\u062f\"\n            },\n            \"specialty\": {\n                \"name\": {\n                    \"ar\": \"\u0637\u0628 \u0627\u0644\u0623\u0633\u0646\u0627\u0646\",\n                    \"en\": \"Dentistry\"\n                }\n            }\n        },\n        \"serviceTypes\": [\n            {\n                \"id\": \"service-uuid\",\n                \"name\": {\n                    \"ar\": \"\u0643\u0634\u0641\",\n                    \"en\": \"Consultation\"\n                },\n                \"price\": 200.00\n            }\n        ]\n    }\n]"
            }
          ]
        }
      ]
    },
    {
      "name": "Appointments",
      "description": "Manage clinic appointments",
      "item": [
        {
          "name": "List Appointments",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "// Save first appointment ID for later use",
                  "if (pm.response.code === 200) {",
                  "    const appointments = pm.response.json();",
                  "    console.log('Found ' + appointments.length + ' appointment(s)');",
                  "    ",
                  "    if (appointments.length > 0) {",
                  "        pm.environment.set('appointmentId', appointments[0].id);",
                  "        console.log('First appointment:', appointments[0].bookingNumber);",
                  "    }",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments"]
            },
            "description": "Get all appointments for assigned clinics.\n\nReturns appointments ordered by date and queue number."
          },
          "response": []
        },
        {
          "name": "List Appointments (Filtered)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Set today's date as default",
                  "const today = new Date().toISOString().split('T')[0];",
                  "pm.environment.set('filterDate', today);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const appointments = pm.response.json();",
                  "    console.log('Found ' + appointments.length + ' appointment(s) for today');",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments?clinicId={{clinicId}}&date={{filterDate}}&status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments"],
              "query": [
                {
                  "key": "clinicId",
                  "value": "{{clinicId}}",
                  "description": "Filter by specific clinic"
                },
                {
                  "key": "date",
                  "value": "{{filterDate}}",
                  "description": "Filter by date (YYYY-MM-DD)"
                },
                {
                  "key": "status",
                  "value": "PENDING",
                  "description": "Filter by status: PENDING, CONFIRMED, CHECKED_IN, COMPLETED, CANCELLED, NO_SHOW"
                }
              ]
            },
            "description": "Get filtered appointments.\n\n**Query Parameters:**\n- `clinicId`: Filter by specific clinic\n- `date`: Filter by date (YYYY-MM-DD format)\n- `status`: Filter by appointment status\n  - PENDING\n  - CONFIRMED\n  - CHECKED_IN\n  - COMPLETED\n  - CANCELLED\n  - NO_SHOW"
          },
          "response": []
        },
        {
          "name": "Get Appointment Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Appointment has required fields', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData).to.have.property('bookingNumber');",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData).to.have.property('appointmentDate');",
                  "    pm.expect(jsonData).to.have.property('appointmentTime');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}"]
            },
            "description": "Get detailed information about a specific appointment."
          },
          "response": []
        },
        {
          "name": "Create Appointment for Patient",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Set appointment date to tomorrow",
                  "const tomorrow = new Date();",
                  "tomorrow.setDate(tomorrow.getDate() + 1);",
                  "pm.environment.set('appointmentDate', tomorrow.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 201 or 200', function() {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "pm.test('Appointment created with booking number', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('bookingNumber');",
                  "    pm.expect(jsonData).to.have.property('id');",
                  "    pm.expect(jsonData.bookedBy).to.equal('secretary');",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.environment.set('newAppointmentId', jsonData.id);",
                  "    console.log('Appointment created:', jsonData.bookingNumber);",
                  "    console.log('Queue Number:', jsonData.queueNumber);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"clinicId\": \"{{clinicId}}\",\n    \"serviceTypeId\": \"{{serviceTypeId}}\",\n    \"patientProfileId\": \"{{patientProfileId}}\",\n    \"appointmentDate\": \"{{appointmentDate}}\",\n    \"appointmentTime\": \"10:00\",\n    \"notes\": \"\u062d\u062c\u0632 \u0628\u0648\u0627\u0633\u0637\u0629 \u0627\u0644\u0633\u0643\u0631\u062a\u064a\u0631\u0629\",\n    \"symptoms\": \"\u0623\u0644\u0645 \u0641\u064a \u0627\u0644\u0623\u0633\u0646\u0627\u0646\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments"]
            },
            "description": "Create a new appointment on behalf of a patient.\n\n**Required Fields:**\n- `clinicId`: The clinic to book at\n- `serviceTypeId`: The type of service\n- `patientProfileId`: The patient's profile ID\n- `appointmentDate`: Date in YYYY-MM-DD format\n- `appointmentTime`: Time in HH:mm format (24-hour)\n\n**Optional Fields:**\n- `notes`: Additional notes\n- `symptoms`: Patient's symptoms"
          },
          "response": [
            {
              "name": "Appointment Created",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"clinicId\": \"clinic-uuid\",\n    \"serviceTypeId\": \"service-uuid\",\n    \"patientProfileId\": \"patient-uuid\",\n    \"appointmentDate\": \"2024-01-20\",\n    \"appointmentTime\": \"10:00\",\n    \"notes\": \"\u062d\u062c\u0632 \u0628\u0648\u0627\u0633\u0637\u0629 \u0627\u0644\u0633\u0643\u0631\u062a\u064a\u0631\u0629\"\n}"
                },
                "url": {
                  "raw": "{{baseUrl}}/secretary/appointments",
                  "host": ["{{baseUrl}}"],
                  "path": ["secretary", "appointments"]
                }
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "json",
              "body": "{\n    \"id\": \"appointment-uuid\",\n    \"bookingNumber\": \"APT-20240120-001\",\n    \"status\": \"PENDING\",\n    \"queueNumber\": 1,\n    \"bookedBy\": \"secretary\",\n    \"appointmentDate\": \"2024-01-20T00:00:00.000Z\",\n    \"appointmentTime\": \"10:00\",\n    \"patientName\": \"\u0645\u062d\u0645\u062f \u0639\u0644\u064a\",\n    \"serviceName\": {\n        \"ar\": \"\u0643\u0634\u0641\",\n        \"en\": \"Consultation\"\n    },\n    \"price\": 200.00\n}"
            }
          ]
        },
        {
          "name": "Confirm Appointment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status updated to CONFIRMED', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('CONFIRMED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"CONFIRMED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "status"]
            },
            "description": "Confirm a pending appointment.\n\n**Valid Transitions for Secretary:**\n- PENDING \u2192 CONFIRMED\n- PENDING \u2192 CANCELLED\n- CONFIRMED \u2192 CHECKED_IN\n- CONFIRMED \u2192 CANCELLED"
          },
          "response": []
        },
        {
          "name": "Check-in Patient",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status updated to CHECKED_IN', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('CHECKED_IN');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"CHECKED_IN\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "status"]
            },
            "description": "Check in a patient when they arrive at the clinic.\n\nThis can only be done for CONFIRMED appointments."
          },
          "response": []
        },
        {
          "name": "Cancel Appointment",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status updated to CANCELLED', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.equal('CANCELLED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"status\": \"CANCELLED\",\n    \"cancellationReason\": \"\u0625\u0644\u063a\u0627\u0621 \u0628\u0646\u0627\u0621\u064b \u0639\u0644\u0649 \u0637\u0644\u0628 \u0627\u0644\u0645\u0631\u064a\u0636\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "status"]
            },
            "description": "Cancel an appointment.\n\n**Required:**\n- `status`: CANCELLED\n\n**Optional:**\n- `cancellationReason`: Reason for cancellation"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Payment Management",
      "description": "Handle appointment payments",
      "item": [
        {
          "name": "Mark as Paid (Cash)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Payment status updated', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.paymentStatus).to.equal('PAID');",
                  "    pm.expect(jsonData.paymentMethod).to.equal('CASH');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"paymentStatus\": \"PAID\",\n    \"paymentMethod\": \"CASH\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/payment",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "payment"]
            },
            "description": "Mark appointment as paid with cash."
          },
          "response": []
        },
        {
          "name": "Mark as Paid (Card)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Payment status updated', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.paymentStatus).to.equal('PAID');",
                  "    pm.expect(jsonData.paymentMethod).to.equal('CARD');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"paymentStatus\": \"PAID\",\n    \"paymentMethod\": \"CARD\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/payment",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "payment"]
            },
            "description": "Mark appointment as paid with card."
          },
          "response": []
        },
        {
          "name": "Mark as Paid (Insurance)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Payment status updated', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.paymentStatus).to.equal('PAID');",
                  "    pm.expect(jsonData.paymentMethod).to.equal('INSURANCE');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"paymentStatus\": \"PAID\",\n    \"paymentMethod\": \"INSURANCE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/payment",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "payment"]
            },
            "description": "Mark appointment as paid via insurance."
          },
          "response": []
        },
        {
          "name": "Process Refund",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Payment status updated to REFUNDED', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.paymentStatus).to.equal('REFUNDED');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n    \"paymentStatus\": \"REFUNDED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/secretary/appointments/{{appointmentId}}/payment",
              "host": ["{{baseUrl}}"],
              "path": ["secretary", "appointments", "{{appointmentId}}", "payment"]
            },
            "description": "Process a refund for a cancelled appointment."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Public Endpoints",
      "description": "Public endpoints that don't require authentication",
      "item": [
        {
          "name": "Search Clinics",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response is an array', function() {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clinics",
              "host": ["{{baseUrl}}"],
              "path": ["clinics"]
            },
            "description": "Search all active clinics (public endpoint)."
          },
          "response": []
        },
        {
          "name": "Get Clinic Details",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clinics/{{clinicId}}",
              "host": ["{{baseUrl}}"],
              "path": ["clinics", "{{clinicId}}"]
            },
            "description": "Get detailed information about a specific clinic."
          },
          "response": []
        },
        {
          "name": "Get Clinic Schedules",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clinics/{{clinicId}}/schedules",
              "host": ["{{baseUrl}}"],
              "path": ["clinics", "{{clinicId}}", "schedules"]
            },
            "description": "Get working hours and schedules for a clinic."
          },
          "response": []
        },
        {
          "name": "Get Available Slots",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Set date to tomorrow",
                  "const tomorrow = new Date();",
                  "tomorrow.setDate(tomorrow.getDate() + 1);",
                  "pm.environment.set('slotDate', tomorrow.toISOString().split('T')[0]);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Status code is 200', function() {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clinics/{{clinicId}}/available-slots?date={{slotDate}}",
              "host": ["{{baseUrl}}"],
              "path": ["clinics", "{{clinicId}}", "available-slots"],
              "query": [
                {
                  "key": "date",
                  "value": "{{slotDate}}",
                  "description": "Date to check availability (YYYY-MM-DD)"
                }
              ]
            },
            "description": "Get available appointment slots for a specific date."
          },
          "response": []
        },
        {
          "name": "Get All Specialties",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/specialties",
              "host": ["{{baseUrl}}"],
              "path": ["specialties"]
            },
            "description": "Get list of all medical specialties."
          },
          "response": []
        },
        {
          "name": "Get All States",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/states",
              "host": ["{{baseUrl}}"],
              "path": ["states"]
            },
            "description": "Get list of all states/governorates."
          },
          "response": []
        },
        {
          "name": "Get Cities by State",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/cities?stateId={{stateId}}",
              "host": ["{{baseUrl}}"],
              "path": ["cities"],
              "query": [
                {
                  "key": "stateId",
                  "value": "{{stateId}}"
                }
              ]
            },
            "description": "Get cities/districts for a specific state."
          },
          "response": []
        }
      ]
    }
  ]
}
